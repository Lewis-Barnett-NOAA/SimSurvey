<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Test sampling design of multiple surveys using a stratified analysis — test_surveys • SimSurvey</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Test sampling design of multiple surveys using a stratified analysis — test_surveys" />

<meta property="og:description" content="This function allows a series of sampling design settings to
be set and tested on the simulated population. True population values are compared
to stratified estimates of abundance." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SimSurvey</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/PaulRegular/SimSurvey">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Test sampling design of multiple surveys using a stratified analysis</h1>
    <small class="dont-index">Source: <a href='https://github.com/PaulRegular/SimSurvey/blob/master/R/test_surveys.R'><code>R/test_surveys.R</code></a></small>
    <div class="hidden name"><code>test_surveys.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>This function allows a series of sampling design settings to
be set and tested on the simulated population. True population values are compared
to stratified estimates of abundance.</p>
    
    </div>

    <pre class="usage"><span class='fu'>test_surveys</span>(<span class='no'>sim</span>, <span class='kw'>surveys</span> <span class='kw'>=</span> <span class='fu'><a href='expand_surveys.html'>expand_surveys</a></span>(), <span class='kw'>keep_details</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>n_sims</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>n_loops</span> <span class='kw'>=</span> <span class='fl'>100</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>export_dir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>resume_test</span>(<span class='kw'>export_dir</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>sim</th>
      <td><p>Simulation from <code><a href='sim_distribution.html'>sim_distribution</a></code>.</p></td>
    </tr>
    <tr>
      <th>surveys</th>
      <td><p>A data.frame or data.table with a sequence of surveys and their settings
with a format like the data.table returned by <code><a href='expand_surveys.html'>expand_surveys</a></code>.</p></td>
    </tr>
    <tr>
      <th>keep_details</th>
      <td><p>Survey and stratified analysis details are dropped here to minimize object
size. This argument allows the user to keep the details of one
survey by specifying the survey number in the data.frame supplied to <code>surveys</code>.</p></td>
    </tr>
    <tr>
      <th>n_sims</th>
      <td><p>Number of times to simulate a survey over the simulated population.
Requesting a large number of simulations here may max out your RAM.</p></td>
    </tr>
    <tr>
      <th>n_loops</th>
      <td><p>Number of times to run the <code><a href='sim_survey.html'>sim_survey</a></code> function. Total
simulations run will be the product of <code>n_sims</code> and <code>n_loops</code>
arguments. Low numbers of <code>n_sims</code> and high numbers of <code>n_loops</code>
will be easier on RAM, but may be slower.</p></td>
    </tr>
    <tr>
      <th>cores</th>
      <td><p>Number of cores to use in parallel. More cores should speed up the process.</p></td>
    </tr>
    <tr>
      <th>export_dir</th>
      <td><p>Directory for exporting results as they are generated. Main use of the export
is to allow this process to pick up where <code>test_survey</code> left off by
calling <code>resume_test</code>. If NULL, nothing is exported.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Arguments passed on to <code>sim_survey</code></p><dl class='dl-horizontal'>
  <dt>sim</dt><dd><p>Simulation from <code><a href='sim_distribution.html'>sim_distribution</a></code></p></dd>
  <dt>n_sims</dt><dd><p>Number of surveys to simulate over the simulated population. Note: requesting
a large number of simulations may max out your RAM. Use
<code><a href='sim_survey_parallel.html'>sim_survey_parallel</a></code> if many simulations are required.</p></dd>
  <dt>q</dt><dd><p>Closure, such as <code><a href='sim_logistic.html'>sim_logistic</a></code>, for simulating catchability at age
(returned values must be between 0 and 1)</p></dd>
  <dt>trawl_dim</dt><dd><p>Trawl width and distance (same units as grid)</p></dd>
  <dt>resample_cells</dt><dd><p>Allow resampling of sampling units (grid cells)? Setting to TRUE may introduce bias
because depletion is imposed at the cell level.</p></dd>
  <dt>binom_error</dt><dd><p>Impose binomial error? Setting to FALSE may introduce bias in stratified estimates
at older ages because of more frequent rounding to zero.</p></dd>
  <dt>min_sets</dt><dd><p>Minimum number of sets per strat</p></dd>
  <dt>set_den</dt><dd><p>Set density (number of sets per [grid unit] squared). WARNING:
may return an error if <code>set_den</code> is high and
<code>resample_cells = FALSE</code> because the number of sets allocated may
exceed the number of cells in a strata.</p></dd>
  <dt>lengths_cap</dt><dd><p>Maximum number of lengths measured per set</p></dd>
  <dt>length_group</dt><dd><p>Length group for otolith collection</p></dd>
  <dt>ages_cap</dt><dd><p>If <code>age_sampling = "length stratified"</code>, this cap represents the
maximum number of otoliths to collect per length group
per division per year. If <code>age_sampling = "random"</code>, it is the
maximum number of otoliths to collect from measured fish per set.</p></dd>
  <dt>age_sampling</dt><dd><p>Should age sampling be length "stratified" or "random"?</p></dd>
  <dt>light</dt><dd><p>Drop some objects from the output to keep object size low?</p></dd>
</dl></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Adds a table of survey designs tested. Also adds details and summary
        stats of stratified estimate error to the <code>sim</code> list, ending with
        <code>"_strat_error"</code> or <code>"_strat_error_stats"</code>. Error statistics
        includes mean absolute error (<code>"MAE"</code>), mean squared error (<code>"MSE"</code>),
        and root mean squared error (<code>"RMSE"</code>). Also adds a sample size summary table
        (<code>"samp_totals"</code>) to the list. Survey and stratified analysis
        details are not kept to minimize object size.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Depening on the settings, <code>test_surveys</code> may take a long time to run.
The <code>resume_test</code> function is for resuming partial runs of <code>test_surveys</code>.
Note that progress bar time estimates will be biased here by previous completions.
<code>test_loop</code> is a helper function used in both <code>test_surveys</code> and
<code>resume_test</code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='no'>pop</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='sim_abundance.html'>sim_abundance</a></span>(<span class='kw'>ages</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>20</span>, <span class='kw'>years</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>5</span>) <span class='kw'>%&gt;%</span>
           <span class='fu'><a href='sim_distribution.html'>sim_distribution</a></span>(<span class='kw'>grid</span> <span class='kw'>=</span> <span class='fu'><a href='make_grid.html'>make_grid</a></span>(<span class='kw'>res</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>10</span>, <span class='fl'>10</span>)))

<span class='no'>surveys</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='expand_surveys.html'>expand_surveys</a></span>(<span class='kw'>set_den</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>1</span>, <span class='fl'>2</span>) / <span class='fl'>1000</span>,
                          <span class='kw'>lengths_cap</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>100</span>, <span class='fl'>500</span>),
                          <span class='kw'>ages_cap</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/c'>c</a></span>(<span class='fl'>5</span>, <span class='fl'>20</span>))

<span class='co'>## This call runs 500 simulations of 8 different surveys over the same</span>
<span class='co'>## population, and then runs a stratified analysis and compares true vs</span>
<span class='co'>## estimated values. It may take a while to run.</span>
<span class='no'>tests</span> <span class='kw'>&lt;-</span> <span class='fu'>test_surveys</span>(<span class='no'>pop</span>, <span class='kw'>surveys</span> <span class='kw'>=</span> <span class='no'>surveys</span>, <span class='kw'>keep_details</span> <span class='kw'>=</span> <span class='fl'>1</span>,
                      <span class='kw'>n_sims</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>n_loops</span> <span class='kw'>=</span> <span class='fl'>50</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fl'>2</span>)

<span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/library'>library</a></span>(<span class='no'>plotly</span>)
<span class='no'>tests</span>$<span class='no'>total_strat_error</span> <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://www.rdocumentation.org/packages/plotly/topics/reexports'>filter</a></span>(<span class='no'>survey</span> <span class='kw'>==</span> <span class='fl'>8</span>, <span class='no'>sim</span> <span class='kw'>%in%</span> <span class='fl'>1</span>:<span class='fl'>50</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://www.rdocumentation.org/packages/plotly/topics/reexports'>group_by</a></span>(<span class='no'>sim</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://www.rdocumentation.org/packages/plotly/topics/plot_ly'>plot_ly</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> ~<span class='no'>year</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://www.rdocumentation.org/packages/plotly/topics/add_trace'>add_lines</a></span>(<span class='kw'>y</span> <span class='kw'>=</span> ~<span class='no'>I_hat</span>, <span class='kw'>alpha</span> <span class='kw'>=</span> <span class='fl'>0.5</span>, <span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"estimated"</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://www.rdocumentation.org/packages/plotly/topics/add_trace'>add_lines</a></span>(<span class='kw'>y</span> <span class='kw'>=</span> ~<span class='no'>I</span>, <span class='kw'>color</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/AsIs'>I</a></span>(<span class='st'>"black"</span>), <span class='kw'>name</span> <span class='kw'>=</span> <span class='st'>"true"</span>) <span class='kw'>%&gt;%</span>
    <span class='fu'><a href='https://www.rdocumentation.org/packages/plotly/topics/layout'>layout</a></span>(<span class='kw'>xaxis</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>title</span> <span class='kw'>=</span> <span class='st'>"Year"</span>),
           <span class='kw'>yaxis</span> <span class='kw'>=</span> <span class='fu'><a href='https://www.rdocumentation.org/packages/base/topics/list'>list</a></span>(<span class='kw'>title</span> <span class='kw'>=</span> <span class='st'>"Abundance index"</span>))

<span class='fu'><a href='plot_trend.html'>plot_total_strat_fan</a></span>(<span class='no'>tests</span>, <span class='kw'>surveys</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>8</span>)
<span class='fu'><a href='plot_trend.html'>plot_length_strat_fan</a></span>(<span class='no'>tests</span>, <span class='kw'>surveys</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>8</span>)
<span class='fu'><a href='plot_trend.html'>plot_age_strat_fan</a></span>(<span class='no'>tests</span>, <span class='kw'>surveys</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>8</span>)
<span class='fu'><a href='plot_trend.html'>plot_age_strat_fan</a></span>(<span class='no'>tests</span>, <span class='kw'>surveys</span> <span class='kw'>=</span> <span class='fl'>1</span>:<span class='fl'>8</span>, <span class='kw'>select_by</span> <span class='kw'>=</span> <span class='st'>"age"</span>)

<span class='fu'><a href='plot_trend.html'>plot_error_surface</a></span>(<span class='no'>tests</span>, <span class='kw'>plot_by</span> <span class='kw'>=</span> <span class='st'>"rule"</span>)
<span class='fu'><a href='plot_trend.html'>plot_error_surface</a></span>(<span class='no'>tests</span>, <span class='kw'>plot_by</span> <span class='kw'>=</span> <span class='st'>"samples"</span>)

<span class='fu'><a href='plot_trend.html'>plot_survey_rank</a></span>(<span class='no'>tests</span>, <span class='kw'>which_strat</span> <span class='kw'>=</span> <span class='st'>"length"</span>)
<span class='fu'><a href='plot_trend.html'>plot_survey_rank</a></span>(<span class='no'>tests</span>, <span class='kw'>which_strat</span> <span class='kw'>=</span> <span class='st'>"age"</span>)

<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Paul Regular.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

