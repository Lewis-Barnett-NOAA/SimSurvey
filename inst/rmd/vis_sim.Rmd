---
title: "Simulation Explorer"
output: flexdashboard::flex_dashboard
always_allow_html: yes
---

```{r setup, echo=FALSE}
library(plotly)
library(viridis)
knitr::opts_chunk$set(echo = FALSE, fig.height = 7, fig.width = 8)
```

```{r data, include=FALSE}
sim <- tmp$sim
```


Abundance
================================================================================

Row
--------------------------------------------------------------------------------

### Total abundance

```{r}
plot_trend(sim)
```

Row
--------------------------------------------------------------------------------

### Abundance at age

```{r}
plot_surface(sim, mat = "N")
```


### Total mortality

```{r}
plot_surface(sim, mat = "Z")
```



Distribution { `r if(!"sp_N" %in% names(sim)) ".hidden"`}
================================================================================

Column {.sidebar}
--------------------------------------------------------------------------------

```{r}
sliderInput("age", "Age", min = min(sim$ages), max = max(sim$ages), 
            value = 1, step = 1)
sliderInput("year", "Year", min = min(sim$years), max = max(sim$years), 
            value = 1, step = 1)
selectInput("type", "Type", choices = c("heatmap", "contour"), 
            selected = "contour")
selectInput("scale", "Scale", choices = c("natural", "log"), 
            selected = "natural")
```

Column
--------------------------------------------------------------------------------

### Distribution

```{r, eval = "sp_N" %in% names(sim)}
renderPlotly({
  plot_distribution(sim, ages = input$age, year = input$year, type = input$type,
                    scale = input$scale)
})

```



